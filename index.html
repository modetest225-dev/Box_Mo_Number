<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2048 بريميوم - محمد حمدي</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --grid-bg: #34495e;
            --cell-empty: #5d6d7e;
            --text-dark: #2c3e50;
            --accent: #e74c3c;
        }
        body { 
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            min-height: 100vh; margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            touch-action: none; overflow: hidden; color: white;
        }
        .header { text-align: center; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .score-container { 
            font-size: 28px; font-weight: 900; background: rgba(255,255,255,0.2); 
            padding: 15px 40px; border-radius: 50px; border: 2px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px); box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .credits { margin-top: 15px; font-size: 20px; font-weight: bold; }
        .credits a { 
            color: #ffda79; text-decoration: none; padding: 5px 15px; 
            border: 2px inset #ffda79; border-radius: 10px; transition: 0.3s;
        }
        .credits a:hover { background: #ffda79; color: #2c3e50; transform: scale(1.1); }
        
        /* تصميم المربع الكبير والمزخرف */
        #game-board { 
            width: 380px; height: 380px; background-color: var(--grid-bg); 
            border-radius: 15px; display: grid; grid-template-columns: repeat(4, 1fr); 
            grid-gap: 12px; padding: 12px; box-sizing: border-box;
            border: 8px solid rgba(0,0,0,0.2); box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .cell { 
            width: 100%; height: 100%; background: var(--cell-empty); 
            border-radius: 8px; display: flex; justify-content: center; align-items: center; 
            font-size: 28px; font-weight: 900; color: white; 
            transition: all 0.15s ease-in-out; box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }

        /* ألوان الأرقام المزخرفة */
        .n2 { background: #1abc9c; color: white; }
        .n4 { background: #2ecc71; color: white; }
        .n8 { background: #3498db; color: white; box-shadow: 0 0 15px #3498db; }
        .n16 { background: #9b59b6; color: white; box-shadow: 0 0 15px #9b59b6; }
        .n32 { background: #f1c40f; color: #2c3e50; }
        .n64 { background: #e67e22; color: white; }
        .n128 { background: #e74c3c; color: white; font-size: 24px; box-shadow: 0 0 20px #e74c3c; }
        .n256 { background: #fd79a8; color: white; font-size: 24px; }
        .n512 { background: #6c5ce7; color: white; font-size: 24px; }
        .n1024 { background: #00cec9; color: white; font-size: 20px; }
        .n2048 { background: #ffe119; color: #2c3e50; font-size: 20px; animation: pulse 1s infinite; }

        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }
        
        @media (max-width: 400px) { #game-board { width: 320px; height: 320px; } .cell { font-size: 22px; } }
    </style>
</head>
<body>

    <div class="header">
        <div class="score-container">السكور: <span id="score">0</span></div>
        <div class="credits">بواسطة المطور: <a href="https://www.facebook.com" target="_blank">محمد حمدي</a></div>
    </div>

    <div id="game-board"></div>

    <script>
        const boardElement = document.getElementById('game-board');
        const scoreElement = document.getElementById('score');
        let board = Array(16).fill(0);
        let score = 0;

        function init() {
            boardElement.innerHTML = '';
            for (let i = 0; i < 16; i++) {
                let cell = document.createElement('div');
                cell.className = 'cell';
                boardElement.appendChild(cell);
            }
            addRandom(); addRandom(); updateView();
        }

        function updateView() {
            const cells = document.querySelectorAll('.cell');
            board.forEach((val, i) => {
                cells[i].innerText = val === 0 ? '' : val;
                cells[i].className = 'cell' + (val ? ' n' + val : '');
                if (val > 0) {
                    cells[i].style.transform = "scale(1.05)";
                    setTimeout(() => cells[i].style.transform = "scale(1)", 100);
                }
            });
            scoreElement.innerText = score;
        }

        function addRandom() {
            let empty = board.map((v, i) => v === 0 ? i : null).filter(v => v !== null);
            if (empty.length) board[empty[Math.floor(Math.random() * empty.length)]] = Math.random() < 0.9 ? 2 : 4;
        }

        function slide(row) {
            let arr = row.filter(v => v);
            for (let i = 0; i < arr.length - 1; i++) {
                if (arr[i] === arr[i+1]) { arr[i] *= 2; score += arr[i]; arr.splice(i+1, 1); }
            }
            while (arr.length < 4) arr.push(0);
            return arr;
        }

        function move(dir) {
            let oldBoard = [...board];
            for (let i = 0; i < 4; i++) {
                let row = [], indices = [];
                for (let j = 0; j < 4; j++) {
                    let idx = (dir === 'L' || dir === 'R') ? i * 4 + j : j * 4 + i;
                    indices.push(idx); row.push(board[idx]);
                }
                if (dir === 'R' || dir === 'D') row.reverse();
                row = slide(row);
                if (dir === 'R' || dir === 'D') row.reverse();
                indices.forEach((idx, j) => board[idx] = row[j]);
            }
            if (JSON.stringify(oldBoard) !== JSON.stringify(board)) { addRandom(); updateView(); }
        }

        // تحسين التاتش 100%
        let startX, startY;
        document.addEventListener('touchstart', e => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        }, {passive: false});

        document.addEventListener('touchmove', e => { e.preventDefault(); }, {passive: false});

        document.addEventListener('touchend', e => {
            if (!startX || !startY) return;
            let diffX = e.changedTouches[0].clientX - startX;
            let diffY = e.changedTouches[0].clientY - startY;
            
            if (Math.abs(diffX) > Math.abs(diffY)) {
                if (Math.abs(diffX) > 30) move(diffX > 0 ? 'R' : 'L');
            } else {
                if (Math.abs(diffY) > 30) move(diffY > 0 ? 'D' : 'U');
            }
            startX = startY = null;
        }, {passive: false});

        window.addEventListener('keydown', e => {
            if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)) e.preventDefault();
            if (e.key === 'ArrowLeft') move('L'); if (e.key === 'ArrowRight') move('R');
            if (e.key === 'ArrowUp') move('U'); if (e.key === 'ArrowDown') move('D');
        });

        init();
    </script>
</body>
</html>
